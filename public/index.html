<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Korrelationer mellan betyg och frånvaro</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      padding: 40px;
      background-color: #f9f9f9;
      color: #333;
    }
    h1, h2 {
      color: #1a237e;
    }
    .container {
      max-width: 1200px;
      margin: auto;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 40px;
      background-color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      border-radius: 8px;
      overflow: hidden;
    }
    th, td {
      border: 1px solid #eee;
      padding: 12px;
      text-align: left;
    }
    th {
      background-color: #e3f2fd;
      cursor: pointer;
    }
    .negativ {
      background-color: #ffebee;
    }
    .positiv {
      background-color: #e8f5e9;
    }
    .dashboard {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    .card {
      background: #fff;
      padding: 20px;
      flex: 1;
      min-width: 250px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .card h3 {
      margin-top: 0;
      color: #0d47a1;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Korrelationer mellan betyg och frånvaro</h1>

    <div class="dashboard" id="dashboard"></div>

    <h2>Ogiltig frånvaro</h2>
    <table id="ogiltig"></table>

    <h2>Total frånvaro</h2>
    <table id="total"></table>

    <h2>Meritvärde</h2>
    <table id="merit"></table>
  </div>

  <script>
    function byggTabell(data, tabellId) {
      const table = document.getElementById(tabellId);
      table.innerHTML = "";
      const header = Object.keys(data[0]);
      const thead = table.createTHead();
      const row = thead.insertRow();
      header.forEach((key, i) => {
        const cell = row.insertCell();
        cell.outerHTML = `<th onclick="sorteraKolumn('${tabellId}', ${i})">${key}</th>`;
      });

      const tbody = table.createTBody();
      data.forEach(rowData => {
        const row = tbody.insertRow();
        header.forEach(key => {
          const cell = row.insertCell();
          cell.textContent = rowData[key];
          if (key === "Korrelation") {
            const v = parseFloat(rowData[key]);
            if (v > 0.2) cell.classList.add("positiv");
            if (v < -0.2) cell.classList.add("negativ");
          }
        });
      });
    }

    function sorteraKolumn(tabellId, kolumnIndex) {
      const table = document.getElementById(tabellId);
      const tbody = table.tBodies[0];
      const rows = Array.from(tbody.rows);
      const isNum = !isNaN(parseFloat(rows[0].cells[kolumnIndex].textContent));

      const sorted = rows.sort((a, b) => {
        const valA = a.cells[kolumnIndex].textContent;
        const valB = b.cells[kolumnIndex].textContent;
        return isNum ? valB - valA : valA.localeCompare(valB);
      });

      sorted.forEach(row => tbody.appendChild(row));
    }

    function läggTillKort(titel, värde, klass = "") {
      const card = document.createElement("div");
      card.className = `card ${klass}`;
      card.innerHTML = `<h3>${titel}</h3><p>${värde}</p>`;
      document.getElementById("dashboard").appendChild(card);
    }

    fetch("json/ogiltig_franvaro.json")
      .then(r => r.json())
      .then(data => {
        byggTabell(data, "ogiltig");
        const medel = data.reduce((acc, r) => acc + parseFloat(r.Korrelation || 0), 0) / data.length;
        läggTillKort("Medel korrelation – Ogiltig", medel.toFixed(2));
      });

    fetch("json/total_franvaro.json")
      .then(r => r.json())
      .then(data => {
        byggTabell(data, "total");
        const medel = data.reduce((acc, r) => acc + parseFloat(r.Korrelation || 0), 0) / data.length;
        läggTillKort("Medel korrelation – Total", medel.toFixed(2));
      });

    Promise.all([
      fetch("json/merit_ogiltig_franvaro.json").then(r => r.json()),
      fetch("json/merit_total_franvaro.json").then(r => r.json())
    ]).then(([ogiltig, total]) => {
      byggTabell([ogiltig, total], "merit");
      const snitt = (parseFloat(ogiltig.Korrelation || 0) + parseFloat(total.Korrelation || 0)) / 2;
      läggTillKort("Medel korrelation – Meritvärde", snitt.toFixed(2));
    });
  </script>
</body>
</html>
